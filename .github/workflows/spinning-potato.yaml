name: Spin That Potato!
on:
  schedule:
    - cron: "*/7 * * * *"  # 7-min intervals (safer rate limit)
  workflow_dispatch:

jobs:
  animate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Rotate Spud
        run: |
          # Track frame state
          FRAME_FILE=".github/potato-frames/current"
          [ -f "$FRAME_FILE" ] && CURRENT=$(cat $FRAME_FILE) || CURRENT=0
          NEW=$(( (CURRENT % 8) + 1 ))
          echo $NEW > $FRAME_FILE
          
          # Update README
          FRAME_CONTENT=$(cat .github/potato-frames/frame$NEW.txt)
          perl -i -pe 'BEGIN{undef $/;} s/<!-- POTATO START -->.*<!-- POTATO END -->/<!-- POTATO START -->\n```\n$ENV{FRAME_CONTENT}\n```\n<!-- POTATO END -->/smg' README.md

      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "ðŸ¥” Potato Rotation Frame $NEW"
          branch: main
